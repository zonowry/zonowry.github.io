<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="我的家庭服务器方案"><meta name=keywords content="PVE,k3s,rancher"><title>在 PVE 容器上部署 k3s + rancher</title>
<link rel=canonical href=https://blog.zonowry.com/posts/deploy_k3s/><link rel=stylesheet href=/scss/style.min.663803bebe609202d5b39d848f2d7c2dc8b598a2d879efa079fa88893d29c49c.css><meta property='og:title' content="在 PVE 容器上部署 k3s + rancher"><meta property='og:description' content="我的家庭服务器方案"><meta property='og:url' content='https://blog.zonowry.com/posts/deploy_k3s/'><meta property='og:site_name' content='Zonowry'><meta property='og:type' content='article'><meta property='article:section' content='Posts'><meta property='article:tag' content='k3s'><meta property='article:tag' content='rancher'><meta property='article:tag' content='pve'><meta property='article:tag' content='docker'><meta property='article:published_time' content='2024-04-15T00:00:00+00:00'><meta property='article:modified_time' content='2024-04-15T00:00:00+00:00'><meta property='og:image' content='https://blog.zonowry.com/posts/deploy_k3s/image-2024_04_16_12_36_53.png'><meta name=twitter:title content="在 PVE 容器上部署 k3s + rancher"><meta name=twitter:description content="我的家庭服务器方案"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content='https://blog.zonowry.com/posts/deploy_k3s/image-2024_04_16_12_36_53.png'><link rel="shortcut icon" href=/favicon.png></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=切换菜单>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu_983aea9f35263846.png width=300 height=300 class=site-logo loading=lazy alt=Avatar></a></figure><div class=site-meta><h1 class=site-name><a href=/>Zonowry</a></h1><h2 class=site-description>zonowry's blog</h2></div></header><ol class=menu-social><li><a href=https://github.com/zonowry target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=mailto:zonowry@outlook.com target=_blank title=Outlook rel=me><svg class="icon icon-tabler icon-tabler-messages" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M21 14l-3-3h-7a1 1 0 01-1-1V4a1 1 0 011-1h9a1 1 0 011 1v10"/><path d="M14 15v2a1 1 0 01-1 1H6l-3 3V11a1 1 0 011-1h2"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/page/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/page/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li><a href=/page/links/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>Links</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>暗色模式</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">目录</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#折腾历程>折腾历程</a></li><li><a href=#lxc-前置条件>LXC 前置条件</a><ol><li><a href=#1-lxc-的权限>1. LXC 的权限</a></li><li><a href=#2-为容器创建-devkmsg>2. 为容器创建 /dev/kmsg</a></li></ol></li><li><a href=#安装-k3s>安装 k3s</a></li><li><a href=#安装-rancher>安装 Rancher</a><ol><li><a href=#1-安装-helm>1. 安装 Helm</a></li><li><a href=#2-helm-添加仓库>2. Helm 添加仓库</a></li><li><a href=#3-为-rancher-创建命名空间>3. 为 Rancher 创建命名空间</a></li><li><a href=#4-rancher-默认需要-ssl-相关配置>4. rancher 默认需要 SSL 相关配置</a></li><li><a href=#5-部署-rancher>5. 部署 rancher</a></li></ol></li><li><a href=#最后部署一个-neo4j-熟悉一下-rancher可选>最后部署一个 NEO4J 熟悉一下 rancher（可选）</a></li></ol></nav></div></section></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/posts/deploy_k3s/><img src=/posts/deploy_k3s/image-2024_04_16_12_36_53_hu_aca31e50bae5384b.png srcset="/posts/deploy_k3s/image-2024_04_16_12_36_53_hu_aca31e50bae5384b.png 800w, /posts/deploy_k3s/image-2024_04_16_12_36_53_hu_f30321d94edcc608.png 1600w" width=800 height=312 loading=lazy alt="Featured image of post 在 PVE 容器上部署 k3s + rancher"></a></div><div class=article-details><div class=article-title-wrapper><h2 class=article-title><a href=/posts/deploy_k3s/>在 PVE 容器上部署 k3s + rancher</a></h2><h3 class=article-subtitle>我的家庭服务器方案</h3></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Apr 15, 2024</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>阅读时长: 3 分钟</time></div></footer></div></header><section class=article-content><h2 id=折腾历程>折腾历程</h2><p>目的本来是实操 <code>k8s</code> 的，部署时搞了一堆花里胡哨的，虽然因为复杂度与资源消耗原因放弃了这套方案~~（=白折腾）~~，但对理解 k8s 的组成部分帮助很大。</p><blockquote><p>曾经的解决方案：</p><ul><li>部署工具：kubeadm</li><li>容器运行时 CRI： cri-o</li><li>容器底层交互接口 OCI ：crun</li><li>容器网络 CNI： cilium</li></ul></blockquote><p>不过部署完这套，小鸡性能吃紧，遂换到了 <code>k3s</code>。</p><p>但将 <code>k3s</code> 作为 <code>HomeServer</code> 使用一段时间后，手写各种 depolyment yaml 很是折磨，远不比 <code>docker-compose</code> 方便，维护工作反而变麻烦了，一度想放弃折腾。</p><p>不过心底还是想坚持用 <code>k8s</code> <del>(大概是跟风吧）</del>，痛点不过是手写 <code>yaml</code>，命令行看日志等等琐碎操作，这些问题 <code>rancher</code> 都可以解决。<del>不过写一些 <code>k8s</code> 的 <code>yaml</code> 后再用 webui 会很容易上手。</del></p><blockquote><p>也有其它的 management，不过 rancher 比较流行，虽然<strong>很重</strong>。轻量一点的也有一个 <a class=link href=https://github.com/skooner-k8s/skooner target=_blank rel=noopener>GitHub - skooner-k8s.</a>，没啥资源的家庭服务器感觉可以考虑。</p></blockquote><h2 id=lxc-前置条件>LXC 前置条件</h2><h3 id=1-lxc-的权限>1. LXC 的权限</h3><p>设置容器 /proc /sys 读写权限、cgroup 权限等</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>vim /etc/pve/lxc/<span class=o>{</span>lxc id<span class=o>}</span>.conf
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 放开权限</span>
</span></span><span class=line><span class=cl>unprivileged: <span class=m>0</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-properties data-lang=properties><span class=line><span class=cl><span class=na>lxc.apparmor.profile</span><span class=o>:</span> <span class=s>unconfined</span>
</span></span><span class=line><span class=cl><span class=na>lxc.cgroup.devices.allow</span><span class=o>:</span> <span class=s>a</span>
</span></span><span class=line><span class=cl><span class=na>lxc.cap.drop</span><span class=o>:</span>
</span></span><span class=line><span class=cl><span class=na>lxc.mount.auto</span><span class=o>:</span> <span class=s>&#34;proc:rw sys:rw&#34;</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=2-为容器创建-devkmsg>2. 为容器创建 /dev/kmsg</h3><p>容器一般不存在 /dev/kmsg 内核日志，<code>k3s</code> 大概会向此“文件”输出消息，所以需要保证容器启动后存在这个文件，容器里存在一个 /dev/console，可以用这个“文件”作替身用。</p><ul><li>自动创建 /dev/kmsg</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>vim /usr/local/bin/conf-kmsg.sh
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=cp>#!/bin/sh -e
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>if</span> <span class=o>[</span> ! -e /dev/kmsg <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>        ln -s /dev/console /dev/kmsg
</span></span><span class=line><span class=cl><span class=k>fi</span>
</span></span><span class=line><span class=cl>mount --make-rshared /
</span></span></code></pre></td></tr></table></div></div><ul><li>创建 systemd 开机执行脚本</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>vim /etc/systemd/system/conf-kmsg.service
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=k>[Unit]</span>
</span></span><span class=line><span class=cl><span class=na>Description</span><span class=o>=</span><span class=s>Make sure /dev/kmsg exists</span>
</span></span><span class=line><span class=cl><span class=k>[Service]</span>
</span></span><span class=line><span class=cl><span class=na>Type</span><span class=o>=</span><span class=s>simple</span>
</span></span><span class=line><span class=cl><span class=na>RemainAfterExit</span><span class=o>=</span><span class=s>yes</span>
</span></span><span class=line><span class=cl><span class=na>ExecStart</span><span class=o>=</span><span class=s>/usr/local/bin/conf-kmsg.sh</span>
</span></span><span class=line><span class=cl><span class=na>TimeoutStartSec</span><span class=o>=</span><span class=s>0</span>
</span></span><span class=line><span class=cl><span class=k>[Install]</span>
</span></span><span class=line><span class=cl><span class=na>WantedBy</span><span class=o>=</span><span class=s>default.target</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>启用生效</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>chmod +x /usr/local/bin/conf-kmsg.sh
</span></span><span class=line><span class=cl>systemctl daemon-reload
</span></span><span class=line><span class=cl>systemctl <span class=nb>enable</span> --now conf-kmsg
</span></span></code></pre></td></tr></table></div></div><h2 id=安装-k3s>安装 k3s</h2><ul><li>从官方中国源安装，默认装最新版</li><li>注意版本号，要与 rancher 兼容</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl -sfL https://rancher-mirror.rancher.cn/k3s/k3s-install.sh <span class=p>|</span> <span class=nv>INSTALL_K3S_MIRROR</span><span class=o>=</span>cn <span class=nv>INSTALL_K3S_VERSION</span><span class=o>=</span>v1.28.7+k3s1 sh -s - server
</span></span></code></pre></td></tr></table></div></div><blockquote><p>需要安装 rancher 支持的 k3s/k8s 版本。k3s 版本列表：<a class=link href=https://docs.k3s.io/zh/release-notes/v1.28.X target=_blank rel=noopener>K3s</a>；
rancher 兼容表： <a class=link href=https://www.suse.com/suse-rancher/support-matrix/all-supported-versions/rancher-v2-8-3/ target=_blank rel=noopener>Rancher Manager v2.8.3 | SUSE</a></p></blockquote><h2 id=安装-rancher>安装 Rancher</h2><h3 id=1-安装-helm>1. 安装 Helm</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl -fsSL -o get_helm.sh https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3
</span></span><span class=line><span class=cl>chmod <span class=m>700</span> get_helm.sh
</span></span><span class=line><span class=cl>./get_helm.sh
</span></span></code></pre></td></tr></table></div></div><p>为了使用 Helm，需要 <code>Kubeconfig</code> 环境变量</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat &gt;&gt; /etc/profile <span class=s>&lt;&lt; EOF
</span></span></span><span class=line><span class=cl><span class=s>export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span><span class=line><span class=cl><span class=nb>source</span> /etc/profile
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 验证一下</span>
</span></span><span class=line><span class=cl>helm list -A
</span></span></code></pre></td></tr></table></div></div><h3 id=2-helm-添加仓库>2. Helm 添加仓库</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>helm repo add rancher-stable https://releases.rancher.com/server-charts/stable
</span></span></code></pre></td></tr></table></div></div><blockquote><p>国内可以用镜像： <code>https://rancher-mirror.rancher.cn/server-charts/stable</code> ，版本可能落后。</p></blockquote><h3 id=3-为-rancher-创建命名空间>3. 为 Rancher 创建命名空间</h3><p>你需要定义一个 Kubernetes 命名空间，用于安装由 Chart 创建的资源。这个命名空间的名称为  <code>cattle-system</code>：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl create namespace cattle-system
</span></span></code></pre></td></tr></table></div></div><h3 id=4-rancher-默认需要-ssl-相关配置>4. rancher 默认需要 SSL 相关配置</h3><p>需要安装 <code>cert-manager</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl apply -f https://github.com/cert-manager/cert-manager/releases/download/v1.13.1/cert-manager.crds.yaml
</span></span></code></pre></td></tr></table></div></div><h3 id=5-部署-rancher>5. 部署 rancher</h3><p><strong>部署后需要通过 <code>hostname</code> 访问 <code>rancher</code></strong>，如果没有 DNS 服务器，应该可以通过修改 <code>hosts</code> 文件映射 <code>ip</code> 访问。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>helm install rancher rancher-stable/rancher --namespace cattle-system --set <span class=nv>hostname</span><span class=o>=</span>rancher.my.org --set <span class=nv>bootstrapPassword</span><span class=o>=</span>admin --version 2.8.3
</span></span></code></pre></td></tr></table></div></div><h2 id=最后部署一个-neo4j-熟悉一下-rancher可选>最后部署一个 NEO4J 熟悉一下 rancher（可选）</h2><ul><li>新建个持久化卷资源<ul><li><code>PersistentVolumes</code><ul><li><code>HostPath</code> 类型</li></ul></li></ul></li><li>再新建个持久化卷请求声明<ul><li><code>PersistentVolumeClaims</code><ul><li>选择刚才建立的 <code>PV</code></li></ul></li></ul></li></ul><p><img src=/posts/deploy_k3s/image-2024_04_16_12_36_53.png width=2093 height=816 srcset="/posts/deploy_k3s/image-2024_04_16_12_36_53_hu_349c3b402a4b78fa.png 480w, /posts/deploy_k3s/image-2024_04_16_12_36_53_hu_817e8be0dd3ae308.png 1024w" loading=lazy class=gallery-image data-flex-grow=256 data-flex-basis=615px></p><ul><li>新增 <code>Deployments</code><ul><li>为 <code>Pod</code> 指定 <code>PVC</code></li><li>容器镜像：<code>neo4j:5.19.0</code></li><li>配置下 <code>Service</code><ul><li>简单点就先 <code>NodePort</code> 了，后面在配 <code>Ingress</code></li></ul></li><li>加个环境变量<ul><li><code>NEO4J_AUTH=user/pwd</code></li></ul></li></ul></li></ul><p><img src=/images/blog/image-2024_04_16_12_42_41.png loading=lazy></p><ul><li>可以查看日志、服务状态，启动成功后。<ul><li>访问 Neo4j http://ip:30075 (nodeport 监听的端口)</li></ul></li></ul></section><footer class=article-footer><section class=article-tags><a href=/tags/k3s/>K3s</a>
<a href=/tags/rancher/>Rancher</a>
<a href=/tags/pve/>Pve</a>
<a href=/tags/docker/>Docker</a></section><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><div class=disqus-container></div><style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style><script>window.addEventListener("onColorSchemeChange",e=>{typeof DISQUS=="object"&&DISQUS.reset({reload:!0})})</script><footer class=site-footer><section class=copyright>&copy;
2020 -
2025 zonowry</section><section class=powerby>使用 <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> 构建<br>主题 <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.30.0>Stack</a></b> 由 <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> 设计</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>